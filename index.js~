// Auto-Bot 2.0
// Lets see how broken this ends up.

// Very Safe Key Storage
const DiscordToken = require('./bottoken.json').token;

const fs = require('fs');
const Discord = require('discord.js');
const client = new Discord.Client();
client.once('ready', () => {
	console.log("Ready!");
});

var AutoChannels = [];
var CreatorChannels = [];

// Load Channel List
WriteCreatorChannels();

client.on("voiceStateUpdate", (oldState, newState) => {
	if (oldState && newState) {
		if (oldState.channelID === newState.channelID) {
			return;
		}
	}

	if (oldState && oldState.channelID) {
		ChannelLeave(oldState.guild.channels.resolve(oldState.channelID));
	}
	if (newState && newState.channelID) {
		ChannelJoin(newState.guild.channels.resolve(newState.channelID));
	}
});

client.login(DiscordToken);

// Channel Functions

function ChannelLeave(channel){
	let userCount = GetChannelUserCount(channel);
	
	console.log(userCount);
}

function ChannelJoin(channel){
	let userCount = GetChannelUserCount(channel);
	
	console.log(channel.members.reduce((acc, member) => acc + 1, 0));
}

function GetChannelUserCount(channel){
	return channel.members.reduce((acc, member) => acc + 1, 0);
}


// FS Functions

function WriteCreatorChannels() {
	fs.open('channellist.json', 'w', (err, fd) => {
  	if (err) {
    		throw err;
  	}
  	fs.writeSync(fd, JSON.stringify(CreatorChannels));
	});
}
